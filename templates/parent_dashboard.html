{% extends "base.html" %}

{% block title %}Parent Dashboard{% endblock %}

{% block header %}Parent Dashboard{% endblock %}

{% block content %}
{% if child %}
<div class="stats">
    <div class="stat-card">
        <h3>${{ "%.2f"|format(current_balance) }}</h3>
        <p>Amount Owed to {{ child.username }}</p>
    </div>
    <div class="stat-card">
        <h3>${{ "%.2f"|format(total_payments) }}</h3>
        <p>Total Paid</p>
    </div>
</div>

<div style="margin-bottom: 20px;">
    <a href="{{ url_for('manage_chore_types') }}" class="btn btn-primary">Manage Chore Types</a>
</div>

<div class="card">
    <h2>Pending Chores (Need Approval)</h2>
    {% if pending_submissions %}
    <table>
        <thead>
            <tr>
                <th>Date Submitted</th>
                <th>Chore</th>
                <th>Value</th>
                <th>Notes</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for submission in pending_submissions %}
            <tr>
                <td>{{ submission.date_submitted.strftime('%m/%d/%Y %H:%M') }}</td>
                <td>
                    <strong>{{ submission.chore_type.name }}</strong><br>
                    <small style="color: #666;">{{ submission.chore_type.description }}</small>
                </td>
                <td>${{ "%.2f"|format(submission.chore_type.value) }}</td>
                <td>{{ submission.notes if submission.notes else '-' }}</td>
                <td>
                    <form method="POST" action="{{ url_for('approve_submission', submission_id=submission.id) }}"
                        style="display: inline;">
                        <button type="submit" class="btn btn-success">Approve</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No pending chores to approve.</p>
    {% endif %}
</div>

<div class="card">
    <h2>Add a Fine</h2>
    <form method="POST" action="{{ url_for('add_fine') }}">
        <div class="form-group">
            <label for="description">Reason for fine</label>
            <input type="text" id="description" name="description" placeholder="e.g., Didn't clean room" required>
        </div>

        <div class="form-group">
            <label for="amount">Fine amount ($)</label>
            <input type="number" id="amount" name="amount" step="0.01" min="0" placeholder="2.00" required>
        </div>

        <button type="submit" class="btn btn-danger">Add Fine</button>
    </form>
</div>

<div class="card">
    <h2>Record a Payment</h2>
    <form method="POST" action="{{ url_for('add_payment') }}">
        <div class="form-group">
            <label for="amount">Payment amount ($)</label>
            <input type="number" id="amount" name="amount" step="0.01" min="0" placeholder="10.00" required>
        </div>

        <button type="submit" class="btn btn-primary">Record Payment</button>
    </form>
</div>

<div class="card">
    <h2>Recently Approved Chores</h2>
    {% if approved_submissions %}
    <table>
        <thead>
            <tr>
                <th>Date Submitted</th>
                <th>Date Approved</th>
                <th>Chore</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            {% for submission in approved_submissions %}
            <tr>
                <td>{{ submission.date_submitted.strftime('%m/%d/%Y') }}</td>
                <td>{{ submission.date_approved.strftime('%m/%d/%Y') if submission.date_approved else 'N/A' }}</td>
                <td>{{ submission.chore_type.name }}</td>
                <td>${{ "%.2f"|format(submission.chore_type.value) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No approved chores yet.</p>
    {% endif %}
</div>

<div class="card">
    <h2>Transaction History</h2>
    {% if transactions %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Description</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for transaction in transactions %}
            <tr>
                <td>{{ transaction.date.strftime('%m/%d/%Y %H:%M') }}</td>
                <td>
                    {% if transaction.type == 'chore' %}
                    <span style="color: #28a745;">âœ“ Chore</span>
                    {% elif transaction.type == 'fine' %}
                    <span style="color: #dc3545;">âš  Fine</span>
                    {% else %}
                    <span style="color: #667eea;">ðŸ’µ Payment</span>
                    {% endif %}
                </td>
                <td>{{ transaction.description }}</td>
                <td>
                    {% if transaction.type == 'chore' %}
                    <span style="color: #28a745;">+${{ "%.2f"|format(transaction.amount) }}</span>
                    {% elif transaction.type == 'fine' %}
                    <span style="color: #dc3545;">-${{ "%.2f"|format(transaction.amount) }}</span>
                    {% else %}
                    <span style="color: #667eea;">-${{ "%.2f"|format(transaction.amount) }}</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No transactions yet.</p>
    {% endif %}
</div>

{% else %}
<div class="card">
    <p>No child account found. Please create one first.</p>
</div>
{% endif %}
{% endblock %}